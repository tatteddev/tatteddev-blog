---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import Giscus from '../components/Giscus.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			/* Blog Post Terminal Theme */
			body {
				/* Use the same background as main page - defined in global.css */
				color: var(--neutral-light);
				font-family: "Atkinson", sans-serif;
				line-height: 1.6;
			}

			main {
				max-width: 1000px;
				margin: 0 auto;
				padding: 2rem 1rem;
				width: 100%;
			}

			/* Terminal-style article container */
			.blog-terminal {
				background: rgba(26, 27, 46, 0.95);
				border: 1px solid var(--neon-blue);
				border-radius: 8px;
				box-shadow: 
					0 0 20px rgba(0, 246, 255, 0.1),
					inset 0 0 20px rgba(0, 246, 255, 0.05);
				overflow: hidden;
				width: 100%;
			}

			/* Terminal header bar */
			.terminal-header {
				background: linear-gradient(135deg, var(--surface), var(--bg-dark));
				padding: 0.75rem 1rem;
				border-bottom: 1px solid var(--neon-blue);
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.terminal-controls {
				display: flex;
				gap: 0.5rem;
			}

			.control {
				width: 12px;
				height: 12px;
				border-radius: 50%;
			}

			.control.close { background: #ff5f56; }
			.control.minimize { background: #ffbd2e; }
			.control.maximize { background: #27ca3f; }

			.file-path {
				margin-left: 1rem;
				font-family: 'Courier New', monospace;
				font-size: 0.9rem;
				color: var(--neutral-mid);
			}

			/* Article content */
			.blog-content {
				padding: 2rem;
			}

			/* Hero image styling */
			.hero-image {
				margin: -2rem -2rem 2rem -2rem;
				position: relative;
			}

			.hero-image img {
				width: 100%;
				height: 300px;
				object-fit: cover;
				border-bottom: 1px solid var(--neon-blue);
			}

			.hero-overlay {
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				background: linear-gradient(transparent, rgba(10, 10, 15, 0.8));
				padding: 2rem;
				color: white;
			}

			/* Title section */
			.title-section {
				margin-bottom: 2rem;
				padding-bottom: 1rem;
				border-bottom: 1px solid rgba(0, 246, 255, 0.3);
			}

			.title-section h1 {
				font-size: 2.5rem;
				font-weight: 700;
				margin: 0 0 1rem 0;
				color: var(--neon-blue);
				text-shadow: 0 0 10px rgba(0, 246, 255, 0.5);
				line-height: 1.2;
			}

			.post-meta {
				display: flex;
				gap: 1rem;
				align-items: center;
				font-family: 'Courier New', monospace;
				font-size: 0.9rem;
				color: var(--neutral-mid);
			}

			.post-date {
				color: var(--accent-lime);
			}

			.last-updated {
				color: var(--neon-pink);
				font-style: italic;
			}

			/* Tags and Category Styling */
			.post-tags {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				margin: 1rem 0;
			}

			.tag {
				background: rgba(182, 255, 0, 0.1);
				color: var(--accent-lime);
				padding: 0.25rem 0.75rem;
				border-radius: 15px;
				font-size: 0.8rem;
				font-family: 'Courier New', monospace;
				border: 1px solid rgba(182, 255, 0, 0.3);
				transition: all 0.3s ease;
			}

			.tag:hover {
				background: rgba(182, 255, 0, 0.2);
				box-shadow: 0 0 10px rgba(182, 255, 0, 0.3);
			}

			.post-category {
				margin: 0.75rem 0;
				font-family: 'Courier New', monospace;
				font-size: 0.9rem;
			}

			.category-label {
				color: var(--neutral-mid);
				margin-right: 0.5rem;
			}

			.category {
				background: rgba(255, 0, 212, 0.1);
				color: var(--neon-pink);
				padding: 0.25rem 0.75rem;
				border-radius: 15px;
				border: 1px solid rgba(255, 0, 212, 0.3);
			}

			/* Content styling */
			.prose {
				font-size: 1.1rem;
				line-height: 1.8;
			}

			.prose h2 {
				color: var(--neon-pink);
				font-size: 1.8rem;
				margin: 2rem 0 1rem 0;
				text-shadow: 0 0 5px rgba(255, 0, 212, 0.3);
			}

			.prose h3 {
				color: var(--accent-lime);
				font-size: 1.4rem;
				margin: 1.5rem 0 0.75rem 0;
				text-shadow: 0 0 5px rgba(182, 255, 0, 0.3);
			}

			.prose h4 {
				color: var(--accent-purple);
				font-size: 1.2rem;
				margin: 1.25rem 0 0.5rem 0;
			}

			.prose p {
				margin: 1rem 0;
				color: var(--neutral-light);
			}

			.prose a {
				color: var(--neon-blue);
				text-decoration: none;
				border-bottom: 1px dotted var(--neon-blue);
				transition: all 0.3s ease;
			}

			.prose a:hover {
				color: var(--neon-pink);
				border-bottom-color: var(--neon-pink);
				text-shadow: 0 0 5px rgba(255, 0, 212, 0.5);
			}

			.prose code {
				background: rgba(0, 246, 255, 0.1);
				color: var(--accent-lime);
				padding: 0.2rem 0.4rem;
				border-radius: 3px;
				font-family: 'Courier New', monospace;
				font-size: 0.9em;
			}

			.prose pre {
				background: rgba(10, 10, 15, 0.8);
				border: 1px solid var(--accent-lime);
				border-radius: 6px;
				padding: 1rem;
				overflow-x: auto;
				margin: 1.5rem 0;
			}

			.prose pre code {
				background: none;
				padding: 0;
				color: var(--accent-lime);
			}

			.prose blockquote {
				border-left: 3px solid var(--neon-pink);
				padding-left: 1rem;
				margin: 1.5rem 0;
				font-style: italic;
				color: var(--neutral-mid);
				background: rgba(255, 0, 212, 0.05);
			}

			.prose ul, .prose ol {
				margin: 1rem 0;
				padding-left: 2rem;
			}

			.prose li {
				margin: 0.5rem 0;
				color: var(--neutral-light);
			}

			/* Floating Particles */
			.particles-container {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				pointer-events: none;
				z-index: -1;
				overflow: hidden;
			}
			
			.particle {
				position: absolute;
				width: 2px;
				height: 2px;
				background: var(--neon-blue);
				border-radius: 50%;
				box-shadow: 0 0 6px var(--neon-blue);
				animation: particle-float 20s infinite linear;
			}
			
			.particle:nth-child(1) {
				left: 10%;
				animation-delay: 0s;
				animation-duration: 18s;
			}
			
			.particle:nth-child(2) {
				left: 20%;
				animation-delay: -3s;
				animation-duration: 22s;
				background: var(--neon-pink);
				box-shadow: 0 0 6px var(--neon-pink);
			}
			
			.particle:nth-child(3) {
				left: 35%;
				animation-delay: -6s;
				animation-duration: 25s;
			}
			
			.particle:nth-child(4) {
				left: 50%;
				animation-delay: -9s;
				animation-duration: 20s;
				background: var(--accent-lime);
				box-shadow: 0 0 6px var(--accent-lime);
			}
			
			.particle:nth-child(5) {
				left: 65%;
				animation-delay: -12s;
				animation-duration: 19s;
			}
			
			.particle:nth-child(6) {
				left: 75%;
				animation-delay: -15s;
				animation-duration: 23s;
				background: var(--accent-purple);
				box-shadow: 0 0 6px var(--accent-purple);
			}
			
			.particle:nth-child(7) {
				left: 85%;
				animation-delay: -18s;
				animation-duration: 21s;
				background: var(--neon-pink);
				box-shadow: 0 0 6px var(--neon-pink);
			}
			
			.particle:nth-child(8) {
				left: 95%;
				animation-delay: -21s;
				animation-duration: 24s;
			}
			
			@keyframes particle-float {
				0% {
					transform: translateY(100vh) translateX(-20px);
					opacity: 0;
				}
				10% {
					opacity: 1;
				}
				90% {
					opacity: 1;
				}
				100% {
					transform: translateY(-100px) translateX(20px);
					opacity: 0;
				}
			}

			/* Mobile responsive */
			@media (max-width: 768px) {
				main {
					padding: 1rem 0.75rem;
					max-width: 100%;
					overflow-x: hidden;
				}

				.blog-terminal {
					margin: 0;
					border-radius: 8px;
					border: 1px solid var(--neon-blue);
					width: 100%;
					max-width: 100%;
				}

				.blog-content {
					padding: 1rem 1.5rem;
				}

				.title-section h1 {
					font-size: 2rem;
					line-height: 1.1;
				}

				.post-meta {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.5rem;
				}

				.hero-image {
					margin: -1rem -1.5rem 1rem -1.5rem;
				}

				.hero-image img {
					height: 200px;
					width: 100%;
				}

				.hero-overlay {
					padding: 1rem 1.5rem;
				}

				.prose {
					font-size: 1rem;
					line-height: 1.6;
					overflow-wrap: break-word;
					word-wrap: break-word;
				}

				.prose h2 {
					font-size: 1.5rem;
				}

				.prose h3 {
					font-size: 1.25rem;
				}

				.prose pre {
					margin-left: -1.5rem;
					margin-right: -1.5rem;
					border-radius: 0;
					padding: 0.75rem 1.5rem;
					overflow-x: auto;
					max-width: 100%;
				}

				.prose pre code {
					white-space: pre;
					word-break: normal;
				}

				.post-tags {
					flex-wrap: wrap;
				}

				.tag {
					font-size: 0.75rem;
				}

				.terminal-header .file-path {
					font-size: 0.75rem;
					display: none; /* Hide on very small screens */
				}
			}

			/* Very small screens */
			@media (max-width: 480px) {
				main {
					padding: 0.5rem 0.5rem;
				}

				.blog-terminal {
					margin: 0;
					border-radius: 6px;
				}

				.blog-content {
					padding: 0.75rem 1rem;
				}

				.title-section h1 {
					font-size: 1.75rem;
				}

				.prose {
					font-size: 0.95rem;
				}

				.hero-image {
					margin: -0.75rem -1rem 1rem -1rem;
				}

				.hero-overlay {
					padding: 1rem;
				}

				.prose pre {
					margin-left: -1rem;
					margin-right: -1rem;
					padding: 0.75rem 1rem;
					max-width: calc(100% + 2rem);
				}

				.post-meta {
					font-size: 0.8rem;
				}
			}
		</style>
	</head>

	<body>
		<!-- Floating Particles -->
		<div class="particles-container">
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
		</div>

		<Header />
		<main>
			<article class="blog-terminal">
				<div class="terminal-header">
					<div class="terminal-controls">
						<span class="control close"></span>
						<span class="control minimize"></span>
						<span class="control maximize"></span>
					</div>
					<div class="file-path">~/blog/{title.toLowerCase().replace(/\s+/g, '-')}.md</div>
				</div>

				<div class="blog-content">
					{heroImage && (
						<div class="hero-image">
							<Image width={900} height={300} src={heroImage} alt={title} />
						</div>
					)}

					<div class="title-section">
						<h1>{title}</h1>
						<div class="post-meta">
							<div class="post-date">
								<FormattedDate date={pubDate} />
							</div>
							{updatedDate && (
								<div class="last-updated">
									Last updated: <FormattedDate date={updatedDate} />
								</div>
							)}
						</div>

						{Astro.props.tags && Astro.props.tags.length > 0 && (
							<div class="post-tags">
								{Astro.props.tags.map((tag) => (
									<span class="tag">{tag}</span>
								))}
							</div>
						)}

						{Astro.props.category && (
							<div class="post-category">
								<span class="category-label">Category:</span>
								<span class="category">{Astro.props.category}</span>
							</div>
						)}
					</div>

					<div class="prose">
						<slot />
					</div>

					<!-- Comments -->
					<Giscus />
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
